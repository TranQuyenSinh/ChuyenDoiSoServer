@using ChuyenDoiSoServer.Utils
@model IEnumerable<Tintuc>

@{
    ViewData["Title"] = ViewData["NavbarTitle"] = "Quản lý tin tức";
    ViewData["ActiveTab"] = "TinTuc";
}

<div class="d-flex justify-content-between mb-3">
    <a class="btn btn-success" asp-action="Create">Thêm tin</a>
    <form asp-action="Index" method="get" class="d-flex gap-2">
        <input
            style="width: 300px;"
            type='text'
            value="@ViewData["Search"]"
            class='form-control'
            name="search"
            placeholder='Tìm kiếm theo tiêu đề, tác giả...'
        />
        <input
            type='submit'
            class='btn btn-primary'
            value="Tìm kiếm"
        />
    </form>
</div>
<table class="table table-striped table-bordered">
    <thead class="bg-dark text-light">
        <tr>
            <th>
                Ảnh bìa
            </th>
            <th>
                Tiêu đề
            </th>
            <th>
                Tác giả
            </th>
            <th>
                Lượt xem
            </th>
            <th>
                Duyệt
            </th>
            <th>
                Ngày đăng
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            var isDuyet = item.Duyet == 1 ? "checked":"";
            <tr>
                <td style="max-width: 300px; text-align: center; vertical-align: center;">
                    <img src="@AppPath.GenerateImagePath(AppPath.TIN_TUC_PHOTO, item.Hinhanh, true)" style="height: 100px;" />
                </td>
                <td style="max-width: 300px;">
                    @Html.DisplayFor(modelItem => item.Tieude)
                </td>
                <td style="max-width: 300px;">
                    @Html.DisplayFor(modelItem => item.User.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Luotxem)
                </td>
                <td>
                    <div class="form-check form-switch">
                        <input onchange="handleDuyetTin(event)" @isDuyet data-id="@item.Id" class="form-check-input m-0"
                            type="checkbox" role="switch">
                    </div>
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CreatedAt)
                </td>
                <td>
                    <a class="btn btn-warning text-light" asp-action="Edit" asp-route-id="@item.Id">
                        <i class="far fa-edit"></i>
                    </a>
                    <a class="btn btn-danger text-light" asp-action="Delete" asp-route-id="@item.Id">
                        <i class="far fa-trash-alt"></i>
                    </a>
                    <a class="btn btn-primary text-light" asp-action="Detail" asp-route-id="@item.Id">
                        <i class="fas fa-info-circle"></i>
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>

@await Component.InvokeAsync("Paging", ViewBag.PagingOptions)

@section Scripts {
    <script type="text/javascript">

        const handleDuyetTin = (event) => {
            let input = event.target;
            let id = input.dataset.id;
            let isDuyet = input.checked ? 1:0;

            $.ajax({
                url: "@Url.Action("DuyetTin")",
                data: {
                    id,
                    isDuyet
                },
                method: "PUT",
            })
        }
    </script>
}